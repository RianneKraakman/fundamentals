---
title: "Exercise 5"
author: "Kyle M. Lang"
date: "Fundamental Techniques in Data Science with R"
params:
  answers: true
output: 
   bookdown::html_document2:
    toc: true
    toc_depth: 1
    toc_float: true
    number_sections: true
---
  
<style type="text/css">
  
body{ /* Normal  */
  font-size: 12px;
  }
td {  /* Table  */
  font-size: 12px;
}
h1.title {
  font-size: 18px;
  color: DarkBlue;
}
h1 { /* Header 1 */
  font-size: 18px;
}
h2 { /* Header 2 */
  font-size: 18px;
}
h3 { /* Header 3 */
  font-size: 18px;
}
code.r{ /* Code block */
  font-size: 12px;
}
pre { /* Code block - determines code spacing between lines */
  font-size: 14px;
}
</style>
  
---
  
```{r setup, echo = FALSE}
library(knitr)
## Define an asis engine that will evaluate inline code within an asis block:
knit_engines$set(asis = function(options) {
  if(options$echo && options$eval) knit_child(text = options$code)
}
)

knitr::opts_chunk$set(include = params$answers, 
                      echo = params$answers, 
                      message = FALSE, 
                      warning = FALSE)
```

We will use the following packages in this practical:

```{r, echo = TRUE, include = TRUE}
library(dplyr)
library(magrittr)
library(ggplot2)
```

In this practical, you will perform regression analyses using `lm()` and create 
plots using `ggplot()`. 

---

# Fitting Linear Models

---

## {#modelEstQ}

**Fit the following linear models using the `anscombe` data:**

- Predict `y1` from `x1` 
   - Stored the results in an object called `fit1`
- Predict `y2` from `x2` 
   - Stored the results in an object called `fit2`
- Predict `y3` from `x3` 
   - Stored the results in an object called `fit3`
- Predict `y4` from `x4` 
   - Stored the results in an object called `fit4`

```{r}
fit1 <- lm(y1 ~ x1, data = anscombe)
fit2 <- lm(y2 ~ x2, data = anscombe)
fit3 <- lm(y3 ~ x3, data = anscombe)
fit4 <- lm(y4 ~ x4, data = anscombe)
```

---

##

**Combine/format output**

Create a 2 $\times$ 4 data frame wherein each column contains the coefficients 
from a different one of the four fitted models you estimated in Question 
\@ref(modelEstQ).

```{r}
output <- data.frame(fit1 = coef(fit1),
                     fit2 = coef(fit2),
                     fit3 = coef(fit3),
                     fit4 = coef(fit4)
                     )
row.names(output) <- names(coef(fit1))

output
```

---

##

**Inspect the estimates from the four models estimated in \@ref(modelEstQ)**

What do you notice about these estimates?

```{asis}
- The estimates are nearly identical across the four models. 
```

---

# Visualizing Bivariate Relations

---

##

**Plot the pair {`x1`, `y1`}**

Use the `ggplot()` function from the **ggplot2** package to create a scatter plot wherein:

- `y1` is plotted on the Y-axis
- `x1` is plotted on the X-axis
- The color of the points is blue

```{r}
anscombe %>%
  ggplot(aes(x = x1, y = y1)) + 
  geom_point(color = "blue")
```

```{asis}
In the above code, we put the aesthetics `aes(x = x1, y = y1)` in the `ggplot()` 
function. When we do so, the aesthetics hold for the entire graph (i.e. all 
geoms we specify), unless we override these aesthetics within specific geoms. 

- Alternatively, we could specify aesthetics for individual geoms.
```

```{r}
anscombe %>%
  ggplot() + 
  geom_point(aes(x = x1, y = y1), color = "blue")
```

```{asis}
We can also override (part of) the aesthetics specified in `ggplot()` by 
specifying different aesthetics  under a geom.
``` 

```{r}
anscombe %>%
  ggplot(aes(x = x1, y = y1), color = "red") + 
  geom_point(aes(x = x2, y = y2), color = "blue")
```

```{asis}
Notice how the `ggplot()` call should produce red points, but the resulting
figure contains blue points.

- We've overridden the `color` aesthetic in `ggplot()` with the `color` 
aesthetic in `geom_point()`.

Notice also that the axis labels are incorrect.

- The plot are was generated from `x1` and `y1`, but the points generated by 
`geom_point()` come from `x2` and `y2`. 
- Be careful when mixing aesthetics!
```

---

## {#plotQ}

**Visualize the four pairs of variables from \@ref(modelEstQ) in a single plot**

Use `ggplot()` to create a single scatter plot wherein the points have the 
following colors:

- Blue for {`x1`, `y1`}
- Gray for {`x2`, `y2`}
- Orange for {`x3`, `y3`}
- Purple for {`x4`, `y4`}

In other words, create the following plot.

```{r include = TRUE}
p1 <- anscombe %>%
  ggplot() + 
  geom_point(aes(x = x1, y = y1), color = "blue") + 
  geom_point(aes(x = x2, y = y2), color = "gray") + 
  geom_point(aes(x = x3, y = y3), color = "orange") + 
  geom_point(aes(x = x4, y = y4), color = "purple") +
  ylab("Y") + 
  xlab("X")

p1
```

---

##

**Add regression lines to the plot from Question \@ref(plotQ)**

Use the `geom_smooth()` function to add linear regression lines with the 
following characteristics:

- One line for {`x3`, `y3`}
- One line for {`x4`, `y4`}
- No lines for {`x1`, `y1`} or {`x2`, `y2`}
- Assign the lines the same color as their respective points
- Don't plot the standard error bands

```{r}
p1 + # Take the plot from above as the starting point 
  geom_smooth(aes(x = x3, y = y3), method = "lm", se = FALSE, color = "orange") + 
  geom_smooth(aes(x = x4, y = y4), method = "lm", se = FALSE, color = "purple")
```

---

##

**Add loess lines to the plot from \@ref(plotQ)**

Use `geom_smooth()` to add loess lines with the following characteristics:

- Add lines for *all pairs except* {`x4`, `y4`}
- Assign the lines the same color as their respective points
- Don't plot the standard error bands

```{r}
p1 + 
  geom_smooth(aes(x = x1, y = y1), method = "loess", se = FALSE, color = "blue") + 
  geom_smooth(aes(x = x2, y = y2), method = "loess", se = FALSE, color = "grey") +
  geom_smooth(aes(x = x3, y = y3), method = "loess", se = FALSE, color = "orange") 
```

---

End of Exercise 5 
